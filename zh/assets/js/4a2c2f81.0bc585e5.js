"use strict";(self.webpackChunk_project_hami_website=self.webpackChunk_project_hami_website||[]).push([[4169],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>d});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),u=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},m=function(e){var n=u(e.components);return r.createElement(l.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,m=c(e,["components","mdxType","originalType","parentName"]),p=u(t),d=a,b=p["".concat(l,".").concat(d)]||p[d]||s[d]||i;return t?r.createElement(b,o(o({ref:n},m),{},{components:t})):r.createElement(b,o({ref:n},m))}));function d(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,o=new Array(i);o[0]=p;var c={};for(var l in n)hasOwnProperty.call(n,l)&&(c[l]=n[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var u=2;u<i;u++)o[u]=t[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},2655:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>s,frontMatter:()=>i,metadata:()=>c,toc:()=>u});var r=t(7462),a=(t(7294),t(3905));const i={title:"Enable cambricon MLU sharing"},o=void 0,c={unversionedId:"userguide/Cambricon-device/enable-cambricon-mlu-sharing",id:"version-v1.3.0/userguide/Cambricon-device/enable-cambricon-mlu-sharing",title:"Enable cambricon MLU sharing",description:"Introduction",source:"@site/versioned_docs/version-v1.3.0/userguide/Cambricon-device/enable-cambricon-mlu-sharing.md",sourceDirName:"userguide/Cambricon-device",slug:"/userguide/Cambricon-device/enable-cambricon-mlu-sharing",permalink:"/zh/docs/userguide/Cambricon-device/enable-cambricon-mlu-sharing",draft:!1,editUrl:"https://github.com/karmada-io/website/edit/main/docs/userguide/Cambricon-device/enable-cambricon-mlu-sharing.md",tags:[],version:"v1.3.0",lastUpdatedBy:"limengxuan",lastUpdatedAt:1713177637,formattedLastUpdatedAt:"2024\u5e744\u670815\u65e5",frontMatter:{title:"Enable cambricon MLU sharing"},sidebar:"version-v1.3.0/docs",previous:{title:"Assign task to a certain GPU",permalink:"/zh/docs/userguide/NVIDIA-device/examples/specify-certain-card"},next:{title:"Allocate device memory",permalink:"/zh/docs/userguide/Cambricon-device/specify-device-memory-usage"}},l={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Enabling MLU-sharing Support",id:"enabling-mlu-sharing-support",level:2},{value:"Running MLU jobs",id:"running-mlu-jobs",level:2}],m={toc:u};function s(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"We now support cambricon.com/mlu by implementing most device-sharing features as nvidia-GPU"),", including:"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"MLU sharing")),": Each task can allocate a portion of MLU instead of a whole MLU card, thus MLU can be shared among multiple tasks."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"Device Memory Control")),": MLUs can be allocated with certain device memory size on certain type(i.e 370) and have made it that it does not exceed the boundary."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"MLU Type Specification")),': You can specify which type of MLU to use or to avoid for a certain task, by setting "cambricon.com/use-mlutype" or "cambricon.com/nouse-mlutype" annotations. '),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"Very Easy to use")),": You don't need to modify your task yaml to use our scheduler. All your MLU jobs will be automatically supported after installation. The only thing you need to do is tag the MLU node."),(0,a.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"neuware-mlu370-driver > 5.0.0"),(0,a.kt)("li",{parentName:"ul"},"cambricon-device-plugin > 2.0.9"),(0,a.kt)("li",{parentName:"ul"},"cntoolkit > 2.5.3")),(0,a.kt)("h2",{id:"enabling-mlu-sharing-support"},"Enabling MLU-sharing Support"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Contact your device provider to aquire cambricon-device-plugin>2.0.9, edit parameter ",(0,a.kt)("inlineCode",{parentName:"li"},"mode")," to 'dynamic-smlu` in containers.args field.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"        args:\n            - --mode=dynamic-smlu # device plugin mode: default, sriov, env-share, topology-aware, dynamic-mim, smlu or dynamic-smlu\n    ...\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Deploy modified cambricon-device-plugin")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Install the chart using helm, See 'enabling vGPU support in kubernetes' section ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Project-HAMi/HAMi#enabling-vgpu-support-in-kubernetes"},"here"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Tag MLU node with the following command"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"kubectl label node {mlu-node} mlu=on\n")),(0,a.kt)("h2",{id:"running-mlu-jobs"},"Running MLU jobs"),(0,a.kt)("p",null,"Cambricon MMLUs can now be requested by a container\nusing the ",(0,a.kt)("inlineCode",{parentName:"p"},"cambricon.com/mlu.smlu.vmemory")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"cambricon.com/mlu.smlu.vcore")," resource type:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: gpu-pod\nspec:\n  containers:\n    - name: ubuntu-container\n      image: ubuntu:18.04\n      command: ["bash", "-c", "sleep 86400"]\n      resources:\n        limits:\n          cambricon.com/mlunum: 1 # requesting 1 MLU\n          cambricon.com/mlu.smlu.vmemory: 20 # each MLU requesting 20% MLU device memory\n          cambricon.com/mlu.smlu.vcore: 10 # each MLU requesting 10% MLU device core\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"NOTICE:")," ",(0,a.kt)("em",{parentName:"p"},(0,a.kt)("inlineCode",{parentName:"em"},"vmemory")," and ",(0,a.kt)("inlineCode",{parentName:"em"},"vcore")," can only work when ",(0,a.kt)("inlineCode",{parentName:"em"},"cambricon.com/mlunum=1")))))}s.isMDXComponent=!0}}]);