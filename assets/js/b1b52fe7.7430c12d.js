"use strict";(self.webpackChunk_project_hami_website=self.webpackChunk_project_hami_website||[]).push([[7754],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},u=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=o,f=u["".concat(s,".").concat(m)]||u[m]||d[m]||r;return n?i.createElement(f,a(a({ref:t},c),{},{components:n})):i.createElement(f,a({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,a=new Array(r);a[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var p=2;p<r;p++)a[p]=n[p];return i.createElement.apply(null,a)}return i.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8148:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var i=n(7462),o=(n(7294),n(3905));const r={title:"How to manage lifted codes"},a=void 0,l={unversionedId:"contributor/lifted",id:"contributor/lifted",title:"How to manage lifted codes",description:"This document explains how lifted code is managed.",source:"@site/docs/contributor/lifted.md",sourceDirName:"contributor",slug:"/contributor/lifted",permalink:"/docs/next/contributor/lifted",draft:!1,editUrl:"https://github.com/karmada-io/website/edit/main/docs/contributor/lifted.md",tags:[],version:"current",lastUpdatedBy:"limengxuan",lastUpdatedAt:1713177637,formattedLastUpdatedAt:"Apr 15, 2024",frontMatter:{title:"How to manage lifted codes"},sidebar:"docs",previous:{title:"GitHub Workflow",permalink:"/docs/next/contributor/github-workflow"},next:{title:"Troubleshooting",permalink:"/docs/next/troubleshooting/"}},s={},p=[{value:"Steps of lifting code",id:"steps-of-lifting-code",level:2},{value:"How to write lifted comments",id:"how-to-write-lifted-comments",level:2},{value:"Examples",id:"examples",level:2},{value:"Lifting function",id:"lifting-function",level:3},{value:"Changed lifting function",id:"changed-lifting-function",level:3},{value:"Lifting const",id:"lifting-const",level:3},{value:"Lifting type",id:"lifting-type",level:3}],c={toc:p};function d(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This document explains how lifted code is managed.\nA common user case for this task is developer lifting code from other repositories to ",(0,o.kt)("inlineCode",{parentName:"p"},"pkg/util/lifted")," directory."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#steps-of-lifting-code"},"Steps of lifting code")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#how-to-write-lifted-comments"},"How to write lifted comments")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#examples"},"Examples"))),(0,o.kt)("h2",{id:"steps-of-lifting-code"},"Steps of lifting code"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Copy code from another repository and save it to a go file under ",(0,o.kt)("inlineCode",{parentName:"li"},"pkg/util/lifted"),"."),(0,o.kt)("li",{parentName:"ul"},"Optionally change the lifted code."),(0,o.kt)("li",{parentName:"ul"},"Add lifted comments for the code ",(0,o.kt)("a",{parentName:"li",href:"#how-to-write-lifted-comments"},"as guided"),"."),(0,o.kt)("li",{parentName:"ul"},"Run ",(0,o.kt)("inlineCode",{parentName:"li"},"hack/update-lifted.sh")," to update the lifted doc ",(0,o.kt)("inlineCode",{parentName:"li"},"pkg/util/lifted/doc.go"),".")),(0,o.kt)("h2",{id:"how-to-write-lifted-comments"},"How to write lifted comments"),(0,o.kt)("p",null,"Lifted comments shall be placed just before the lifted code (could be a func, type, var or const). Only empty lines and comments are allowed between lifted comments and lifted code."),(0,o.kt)("p",null,"Lifted comments are composed by one or multi comment lines, each in the format of ",(0,o.kt)("inlineCode",{parentName:"p"},"+lifted:KEY[=VALUE]"),". Value is optional for some keys."),(0,o.kt)("p",null,"Valid keys are as follow\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"source:"),(0,o.kt)("p",{parentName:"li"},"Key ",(0,o.kt)("inlineCode",{parentName:"p"},"source")," is required. Its value indicates where the code is lifted from.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"changed:"),(0,o.kt)("p",{parentName:"li"},"Key ",(0,o.kt)("inlineCode",{parentName:"p"},"changed")," is optional. It indicates whether the code is changed. Value is optional (",(0,o.kt)("inlineCode",{parentName:"p"},"true")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),", defaults to ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),"). Not adding this key or setting it to ",(0,o.kt)("inlineCode",{parentName:"p"},"false")," means no code change."))),(0,o.kt)("h2",{id:"examples"},"Examples"),(0,o.kt)("h3",{id:"lifting-function"},"Lifting function"),(0,o.kt)("p",null,"Lift function ",(0,o.kt)("inlineCode",{parentName:"p"},"IsQuotaHugePageResourceName")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"corehelpers.go"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"// +lifted:source=https://github.com/kubernetes/kubernetes/blob/release-1.23/pkg/apis/core/helper/helpers.go#L57-L61\n\n// IsQuotaHugePageResourceName returns true if the resource name has the quota\n// related huge page resource prefix.\nfunc IsQuotaHugePageResourceName(name corev1.ResourceName) bool {\n    return strings.HasPrefix(string(name), corev1.ResourceHugePagesPrefix) || strings.HasPrefix(string(name), corev1.ResourceRequestsHugePagesPrefix)\n}\n")),(0,o.kt)("p",null,"Added in ",(0,o.kt)("inlineCode",{parentName:"p"},"doc.go"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-markdown"},"| lifted file              | source file                                                                                                                   | const/var/type/func                     | changed |\n|--------------------------|-------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|---------|\n| corehelpers.go           | https://github.com/kubernetes/kubernetes/blob/release-1.23/pkg/apis/core/helper/helpers.go#L57-L61                            | func IsQuotaHugePageResourceName        | N       |\n")),(0,o.kt)("h3",{id:"changed-lifting-function"},"Changed lifting function"),(0,o.kt)("p",null,"Lift and change function ",(0,o.kt)("inlineCode",{parentName:"p"},"GetNewReplicaSet")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"deployment.go")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"// +lifted:source=https://github.com/kubernetes/kubernetes/blob/release-1.22/pkg/controller/deployment/util/deployment_util.go#L536-L544\n// +lifted:changed\n\n// GetNewReplicaSet returns a replica set that matches the intent of the given deployment; get ReplicaSetList from client interface.\n// Returns nil if the new replica set doesn't exist yet.\nfunc GetNewReplicaSet(deployment *appsv1.Deployment, f ReplicaSetListFunc) (*appsv1.ReplicaSet, error) {\n    rsList, err := ListReplicaSetsByDeployment(deployment, f)\n    if err != nil {\n        return nil, err\n    }\n    return FindNewReplicaSet(deployment, rsList), nil\n}\n")),(0,o.kt)("p",null,"Added in ",(0,o.kt)("inlineCode",{parentName:"p"},"doc.go"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-markdown"},"| lifted file              | source file                                                                                                                   | const/var/type/func                     | changed |\n|--------------------------|-------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|---------|\n| deployment.go            | https://github.com/kubernetes/kubernetes/blob/release-1.22/pkg/controller/deployment/util/deployment_util.go#L536-L544        | func GetNewReplicaSet                   | Y       |\n")),(0,o.kt)("h3",{id:"lifting-const"},"Lifting const"),(0,o.kt)("p",null,"Lift const ",(0,o.kt)("inlineCode",{parentName:"p"},"isNegativeErrorMsg")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"corevalidation.go  "),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"// +lifted:source=https://github.com/kubernetes/kubernetes/blob/release-1.22/pkg/apis/core/validation/validation.go#L59\nconst isNegativeErrorMsg string = apimachineryvalidation.IsNegativeErrorMsg\n")),(0,o.kt)("p",null,"Added in ",(0,o.kt)("inlineCode",{parentName:"p"},"doc.go"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-markdown"},"| lifted file              | source file                                                                                                                   | const/var/type/func                     | changed |\n|--------------------------|-------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|---------|\n| corevalidation.go        | https://github.com/kubernetes/kubernetes/blob/release-1.22/pkg/apis/core/validation/validation.go#L59                         | const isNegativeErrorMsg                | N       |\n")),(0,o.kt)("h3",{id:"lifting-type"},"Lifting type"),(0,o.kt)("p",null,"Lift type ",(0,o.kt)("inlineCode",{parentName:"p"},"Visitor")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"visitpod.go"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"// +lifted:source=https://github.com/kubernetes/kubernetes/blob/release-1.23/pkg/api/v1/pod/util.go#L82-L83\n\n// Visitor is called with each object name, and returns true if visiting should continue\ntype Visitor func(name string) (shouldContinue bool)\n")),(0,o.kt)("p",null,"Added in ",(0,o.kt)("inlineCode",{parentName:"p"},"doc.go"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-markdown"},"| lifted file              | source file                                                                                                                   | const/var/type/func                     | changed |\n|--------------------------|-------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|---------|\n| visitpod.go              | https://github.com/kubernetes/kubernetes/blob/release-1.23/pkg/api/v1/pod/util.go#L82-L83                                     | type Visitor                            | N       |\n")))}d.isMDXComponent=!0}}]);